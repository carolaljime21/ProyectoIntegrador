import play.api.libs.json._
import scala.util.{Failure, Success, Try}
import com.github.tototoshi.csv._
import java.io.File
import requests.Response
import scalikejdbc._
import java.nio.charset.StandardCharsets
import java.nio.file.{Files, Paths, StandardOpenOption}

object Main extends App{

  val reader = CSVReader.open(new File("C:/Users/HP/Desktop/Proyecto/movie_dataset.csv"))
  val data = reader.allWithHeaders()
  reader.close()

  case class directors(id: Int,
                      name: String)

  val SQL_INSERT_PATTERN =
    """INSERT INTO DIRECTORS (`ID`, `NAME`)
      |VALUES
      |('%d', '%s');
      |""".stripMargin

  val movieDirectors = data
    .map(row => directors(
      row("id").toInt,
      row("director")))

  val scriptData = movieDirectors
    .map(movie => SQL_INSERT_PATTERN.formatLocal(java.util.Locale.US,
      movie.id,
      movie.name
    ))

  val scriptFile = new File("C:/Users/HP/Desktop/scripts/directors")
  if (scriptFile.exists()) scriptFile.delete()

  scriptData.foreach(insert =>
    Files.write(Paths.get("C:/Users/HP/Desktop/scripts/directors"),
      insert.getBytes(StandardCharsets.UTF_8),
      StandardOpenOption.CREATE,
      StandardOpenOption.APPEND)
  )
}
